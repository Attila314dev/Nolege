<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kv√≠zszob√°k ‚Ä¢ Lobby</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="wrap">
    <h1>üß† Kv√≠zszob√°k</h1>

    <section class="card">
      <h2>√öj szoba (Admin)</h2>
      <label>Admin nick:
        <input id="adminNick" placeholder="pl. F≈ën√∂k" maxlength="12" />
      </label>
      <label>Szoba jelsz√≥:
        <input id="adminPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>
      <button id="createBtn">Szoba l√©trehoz√°sa</button>
      <p id="createOut" class="mono small"></p>
    </section>

    <section class="card">
      <h2>Csatlakoz√°s j√°t√©kosk√©nt</h2>
      <label>Szobak√≥d:
        <input id="joinRoom" placeholder="pl. ab12cd" maxlength="6" />
      </label>
      <label>Jelsz√≥:
        <input id="joinPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>
      <label>Nick:
        <input id="joinNick" placeholder="pl. Pisti" maxlength="12" />
      </label>
      <button id="joinBtn">Bel√©p√©s</button>
      <p id="joinOut" class="mono small"></p>
    </section>

    <section class="card">
      <h2>El√©rhet≈ë szob√°k</h2>
      <div class="flex space">
        <button id="refreshRooms">Friss√≠t√©s</button>
        <span class="small mono">Automatikus friss√≠t√©s 5 mp-enk√©nt</span>
      </div>
      <ul id="roomList" class="players topgap"></ul>

      <div class="topgap small">Spectator bel√©p√©s (csak n√©z√©s, TV-re):</div>
      <label>Szobak√≥d: <input id="specRoom" maxlength="6" /></label>
      <label>Jelsz√≥: <input id="specPass" type="password" /></label>
      <button id="specBtn">Spectate</button>
    </section>
  </main>

  <script>
    // √öj szoba
    const createBtn = document.getElementById('createBtn');
    const createOut = document.getElementById('createOut');
    createBtn.onclick = async () => {
      const adminNick = document.getElementById('adminNick').value.trim();
      const password = document.getElementById('adminPass').value.trim();
      if (!adminNick || !password) { createOut.textContent = "Add meg a nevet √©s jelsz√≥t"; return; }

      const res = await fetch('/api/createRoom', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ password, adminNick })
      });
      const data = await res.json();
      if (!res.ok) { createOut.textContent = data.error || 'Hiba'; return; }
      const roomId = data.roomId;
      const link = `${location.origin}/room.html?room=${roomId}&admin=1&pw=${encodeURIComponent(password)}&nick=${encodeURIComponent(adminNick)}`;
      createOut.textContent = `K√©sz! Szobak√≥d: ${roomId}`;
      setTimeout(()=> location.href = link, 700);
    };

    // Join j√°t√©kosk√©nt
    const joinBtn = document.getElementById('joinBtn');
    const joinOut = document.getElementById('joinOut');
    joinBtn.onclick = async () => {
      const roomId = document.getElementById('joinRoom').value.trim().toLowerCase();
      const password = document.getElementById('joinPass').value.trim();
      const nick = document.getElementById('joinNick').value.trim();
      if (!roomId || !password || !nick) { joinOut.textContent = "Minden mez≈ë k√∂telez≈ë"; return; }

      const res = await fetch('/api/join', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ roomId, password, nick })
      });
      const data = await res.json();
      if (!res.ok) { joinOut.textContent = data.error || 'Hiba'; return; }
      const link = `${location.origin}/room.html?room=${roomId}&pw=${encodeURIComponent(password)}&nick=${encodeURIComponent(nick)}`;
      location.href = link;
    };

    // Szobalista
    const roomList = document.getElementById('roomList');
    const refreshBtn = document.getElementById('refreshRooms');
    async function loadRooms(){
      try{
        const res = await fetch('/api/rooms');
        const data = await res.json();
        roomList.innerHTML = (data||[]).map(r =>
          `<li><b>${r.id}</b><span>${r.players} j√°t√©kos${r.running ? ' ‚Ä¢ folyamatban' : ''}</span></li>`
        ).join('') || '<li>(nincs akt√≠v szoba)</li>';
      }catch(e){
        roomList.innerHTML = '<li>(nem el√©rhet≈ë)</li>';
      }
    }
    refreshBtn.onclick = loadRooms;
    loadRooms(); setInterval(loadRooms, 5000);

    // Spectator bel√©p√©s
    document.getElementById('specBtn').onclick = () => {
      const room = document.getElementById('specRoom').value.trim().toLowerCase();
      const pw = document.getElementById('specPass').value.trim();
      if(!room || !pw) return alert('Add meg a szobak√≥dot √©s a jelsz√≥t');
      location.href = `${location.origin}/room.html?room=${room}&pw=${encodeURIComponent(pw)}&spectator=1`;
    };
  </script>
</body>
</html>
