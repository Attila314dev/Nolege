<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kv√≠zszob√°k ‚Ä¢ Lobby</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="wrap">
    <h1>üß† Kv√≠zszob√°k</h1>
    <section class="card">
      <h2>√öj szoba (Admin)</h2>
      <label>Admin nick:
        <input id="adminNick" placeholder="pl. F≈ën√∂k" maxlength="12" />
      </label>
      <label>Szoba jelsz√≥:
        <input id="adminPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>
      <button id="createBtn">Szoba l√©trehoz√°sa</button>
      <p id="createOut" class="mono small"></p>
    </section>

    <section class="card">
      <h2>Csatlakoz√°s megl√©v≈ë szob√°hoz</h2>
      <label>Szobak√≥d:
        <input id="joinRoom" placeholder="pl. ab12cd" maxlength="6" />
      </label>
      <label>Jelsz√≥:
        <input id="joinPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>
      <label>Nick:
        <input id="joinNick" placeholder="pl. Pisti" maxlength="12" />
      </label>
      <button id="joinBtn">Bel√©p√©s</button>
      <p id="joinOut" class="mono small"></p>
    </section>
  </main>

  <script>
    const createBtn = document.getElementById('createBtn');
    const createOut = document.getElementById('createOut');

    createBtn.onclick = async () => {
      const adminNick = document.getElementById('adminNick').value.trim();
      const password = document.getElementById('adminPass').value.trim();
      if (!adminNick || !password) { createOut.textContent = "Add meg a nevet √©s jelsz√≥t"; return; }

      const res = await fetch('/api/createRoom', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ password, adminNick })
      });
      const data = await res.json();
      if (!res.ok) { createOut.textContent = data.error || 'Hiba'; return; }
      const roomId = data.roomId;
      const link = `${location.origin}/room.html?room=${roomId}&admin=1&pw=${encodeURIComponent(password)}&nick=${encodeURIComponent(adminNick)}`;
      createOut.textContent = `K√©sz! Szobak√≥d: ${roomId}`;
      setTimeout(()=> location.href = link, 700);
    };

    const joinBtn = document.getElementById('joinBtn');
    const joinOut = document.getElementById('joinOut');
    joinBtn.onclick = async () => {
      const roomId = document.getElementById('joinRoom').value.trim().toLowerCase();
      const password = document.getElementById('joinPass').value.trim();
      const nick = document.getElementById('joinNick').value.trim();
      if (!roomId || !password || !nick) { joinOut.textContent = "Minden mez≈ë k√∂telez≈ë"; return; }

      const res = await fetch('/api/join', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ roomId, password, nick })
      });
      const data = await res.json();
      if (!res.ok) { joinOut.textContent = data.error || 'Hiba'; return; }
      const link = `${location.origin}/room.html?room=${roomId}&pw=${encodeURIComponent(password)}&nick=${encodeURIComponent(nick)}`;
      location.href = link;
    };
  </script>
</body>
</html>
